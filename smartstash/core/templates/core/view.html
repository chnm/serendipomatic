{% extends 'site_base.html' %}
{% load static %}

{% block title %}MagicStash Items Display{% endblock %}

{% block content %}
<ul id="sort-by">
  <li><a href="#iso_title">Item Type</a></li>
  <li><a href="#iso_date">Date</a></li>
  <li><a href="#iso_region">Region</a></li>
</ul>

<p>
<a href="{% url 'site-index' %}"><button class="magic" tabindex="5">Start Over</button></a>
<a href="{% url 'saveme' %}" target="_blank"><button class="magic" tabindex="6">Save Results</button></a>
<a href="{% url 'site-index' %}"><button class="magic" tabindex="5">Refresh Results</button></a>
<a href="{% url 'saveme' %}" target="_blank"><button class="magic" tabindex="6">Rearrange Results</button></a>
</p>

<p>
<strong>Query Terms:</strong> {{ query_terms.keywords|join:', ' }}
<br />
<strong>Sources Used:</strong>
{% for source in sources %}<a href="{{ source.url }}" target="_blank">{{ source.name }}</a>{% if not forloop.last %}, {% endif %}{% endfor %}
</p>

<div id="container" class="clickable variable-sizes clearfix">
{% for item in items %}



<!-- Insert below into results page. Semi-opaque overlay from top of differently sized images. Suck text data into .overlay and image into .imageframe -->

<div class="imageframe">
        <img src="{{ item.thumbnail }}" alt="{{ item.title }}" >
	<div class="overlay">
		<div class="iso_title">Title: <a href="{{ item.url }}">{{ item.title }}</a></div>
		<div class="iso_date">Date: {{ item.date }}</div>
	</div>
</div>






<!-- Change the number in the add filter depending on the number of tabindexes required before results. -->
<!--
<div class="hover panel" tabindex="{{ forloop.counter|add:6 }}">
	<div class="front">
		<div class="pad">
		<div class="photo">
	<div class="iso_image"><a href="{{ item.url }}" target="_blank">
            <img class="imgLiquidFill" src="{{ item.thumbnail }}" alt="{{ item.title }}" style="width:150px; height:150px;">
        </a></div>
		</div>
		</div>
	</div>
	<div class="back">
		<div class="pad">
			<div class="iso_date">Date: {{ item.date }}</div>
			<div class="iso_title">Title: <a href="{{ item.url }}">{{ item.title }}</a></div>
			<div class="iso_title">Location: <a href="{{ item.location }}">{{ item.location }}</a></div>
		</div>
	</div>
</div>
<input type="hidden" value="{{ item.location }}"/>
{% endfor %}
</div>

-->












<a href="#top"><button tabindex="1000">Return to Top</button></a>
{% comment %}
{{ item.title|default:'(no source)' }}
{% endcomment %}

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="{% static 'js/jquery-1.10.2.js' %}">\x3C/script>')</script>
<!--  <script src="http://isotope.metafizzy.co/jquery.isotope.min.js"></script> -->
<script src="{% static 'js/isotope-1.5.25.js' %}"></script>
<script src="{% static 'js/scripts_view.js' %}"></script>
<!-- Image resizing: https://github.com/karacas/imgLiquid -->
<script src="https://dl.dropboxusercontent.com/u/6983010/wserv/imgLiquid/js/imgLiquid-min.js"></script>
<script>
$(document).ready(function() {
    $(".imgLiquidFill").imgLiquid();
});
</script>
<script type="text/javascript">
   // Populates broken image links with default image
   $(window).load(function() {
      $("img").each(function(){
         var image = $(this);
         if(image.context.naturalWidth == 0 ||
         image.readyState == 'uninitialized'){
            $(image).unbind("error").attr(
                "src", "http://news.bbcimg.co.uk/media/images/69039000/jpg/_69039173_jkrowling_pa.jpg"
            );
         }
    });
});
</script>
{% endblock %}
<script>
// For sorting
$(document).ready(function() {
    $('#sort-by a').click(function(){
      // get href attribute, minus the '#'
      var sortName = $(this).attr('href').slice(1);
      $('#container').isotope({ sortBy : sortName });
      return false;
    });
});

 // custom layout mode spineAlign
  $.Isotope.prototype._spineAlignReset = function() {
    this.spineAlign = {
      colA: 0,
      colB: 0
    };
  };

  $.Isotope.prototype._spineAlignLayout = function( $elems ) {
    var instance = this,
        props = this.spineAlign,
        gutterWidth = Math.round( this.options.spineAlign && this.options.spineAlign.gutterWidth ) || 0,
        centerX = Math.round(this.element.width() / 2);

    $elems.each(function(){
      var $this = $(this),
          isColA = props.colA <= props.colB,
          x = isColA ?
            centerX - ( $this.outerWidth(true) + gutterWidth / 2 ) : // left side
            centerX + gutterWidth / 2, // right side
          y = isColA ? props.colA : props.colB;
      instance._pushPosition( $this, x, y );
      props[( isColA ? 'colA' : 'colB' )] += $this.outerHeight(true);
    });
  };

  $.Isotope.prototype._spineAlignGetContainerSize = function() {
    var size = {};
    size.height = this.spineAlign[( this.spineAlign.colB > this.spineAlign.colA ? 'colB' : 'colA' )];
    return size;
  };

  $.Isotope.prototype._spineAlignResizeChanged = function() {
    return true;
  };


  $(function(){

    var $container = $('#container');


      // add randomish size classes
      $container.find('.element').each(function(){
        var $this = $(this),
            number = parseInt( $this.find('.number').text(), 10 );
        if ( number % 7 % 2 === 1 ) {
          $this.addClass('width2');
        }
        if ( number % 3 === 0 ) {
          $this.addClass('height2');
        }
      });

    $container.isotope({
      itemSelector : '.element',
      layoutMode: 'spineAlign',
      spineAlign: {
        gutterWidth: 20
      },
      getSortData : {
        symbol : function( $elem ) {
          return $elem.attr('data-symbol');
        },
        category : function( $elem ) {
          return $elem.attr('data-category');
        },
        number : function( $elem ) {
          return parseInt( $elem.find('.number').text(), 10 );
        },
        weight : function( $elem ) {
          return parseFloat( $elem.find('.weight').text().replace( /[\(\)]/g, '') );
        },
        name : function ( $elem ) {
          return $elem.find('.name').text();
        }
      }
    });


      var $optionSets = $('#options .option-set'),
          $optionLinks = $optionSets.find('a');

      $optionLinks.click(function(){
        var $this = $(this);
        // don't proceed if already selected
        if ( $this.hasClass('selected') ) {
          return false;
        }
        var $optionSet = $this.parents('.option-set');
        $optionSet.find('.selected').removeClass('selected');
        $this.addClass('selected');

        // make option object dynamically, i.e. { filter: '.my-filter-class' }
        var options = {},
            key = $optionSet.attr('data-option-key'),
            value = $this.attr('data-option-value');
        // parse 'false' as false boolean
        value = value === 'false' ? false : value;
        options[ key ] = value;
        if ( key === 'layoutMode' && typeof changeLayoutMode === 'function' ) {
          // changes in layout modes need extra logic
          changeLayoutMode( $this, options )
        } else {
          // otherwise, apply new options
          $container.isotope( options );
        }

        return false;
      });



      $('#insert a').click(function(){
        var $newEls = $( fakeElement.getGroup() );
        $container.isotope( 'insert', $newEls );

        return false;
      });

      $('#append a').click(function(){
        var $newEls = $( fakeElement.getGroup() );
        $container.append( $newEls ).isotope( 'appended', $newEls );

        return false;
      });



      // change size of clicked element
      $container.delegate( '.element', 'click', function(){
        $(this).toggleClass('large');
        $container.isotope('reLayout');
      });

      // toggle variable sizes of all elements
      $('#toggle-sizes').find('a').click(function(){
        $container
          .toggleClass('variable-sizes')
          .isotope('reLayout');
        return false;
      });


    var $sortBy = $('#sort-by');
    $('#shuffle a').click(function(){
      $container.isotope('shuffle');
      $sortBy.find('.selected').removeClass('selected');
      $sortBy.find('[data-option-value="random"]').addClass('selected');
      return false;
    });

  });
</script>